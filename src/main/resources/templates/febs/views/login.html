<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<title>ITS PRINSMA System</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" th:href="@{layui/css/layui.css(t=2)}" media="all">
		<link rel="stylesheet" th:href="@{febs/css/febs.css(t=2)}" media="all">
		<link rel="stylesheet" th:href="@{febs/css/login.css(t=2)}" media="all">
		<link rel="icon" th:href="@{febs/images/favicon.ico}" type="image/x-icon" />
		<style>
			#item_dept li span:first-child{
				display: none;
			}
		</style>	
	</head>
	<body>
		<div id="febs-login" th:lay-title="#{user.login}">
			<div class="login-wrap">
				<div class="layui-container">
					<a style="float: right;" class="febs-hide" id="changeLangEN">EN&nbsp;&nbsp;&nbsp;&nbsp;</a>
					<a style="float: right;" class="febs-hide" id="changeLangZH">中文&nbsp;&nbsp;&nbsp;&nbsp;</a>
					<div class="layui-row">
						<div class="layui-col-xs12 layui-col-lg4 layui-col-lg-offset4 febs-tc">
							<img data-th-src="@{febs/images/logo.png}" style="margin-top: 20px;" />
							<div class="layui-logo"><span><b>ITS</b> PRINSMA System</span></div>
						</div>
						<div class="layui-col-xs12 layui-col-lg4 layui-col-lg-offset4" id="login-div">
							<div class="layui-form" lay-filter="login-form">
								<div class="layui-anim layui-anim-upbit">
									<ul class="login-type-tab">
										<li class="active">
											<!--系统登录-->
										</li>
									</ul>
									<div class="normal-login-form">
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-username"></label>
											<input type="text" name="username" lay-verify="required" th:placeholder="#{user.name}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item password-block">
											<label class="layui-icon label-icon layui-icon-password"></label>
											<input type="password" name="password" lay-verify="required" th:placeholder="#{user.password}" autocomplete="off" class="layui-input">
										</div>
										<!--<div class="layui-form-item">
                                    <div class="layui-row">
                                        <div class="layui-col-xs7">
                                            <label class="layui-icon label-icon layui-icon-vercode"></label>
                                            <input type="text" maxlength="4" name="verifyCode" lay-verify="required"
                                                   th:placeholder="#{user.verifyCode}" class="layui-input" autocomplete="off">
                                        </div>
                                        <div class="layui-col-xs5">
                                            <img class="codeimg" id="codeimg"/>
                                        </div>
                                    </div>
                                </div>-->
										<div class="layui-form-item" style="margin-top: -10px;">
											<input type="checkbox" name="rememberMe" th:title="#{user.remember}" lay-skin="primary">
										</div>
										<div class="layui-form-item">
											<button class="layui-btn layui-btn-normal layui-btn-fluid" lay-submit lay-filter="login-submit" id="login">
												<i style="display: none" class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i>
												[[#{user.login}]]
											</button>
										</div>
									</div>
									<div class="layui-form-item febs-tr">
										<a id="regist-href" style="text-decoration: underline; color: black; float:right">[[#{user.regist}]]</a>&nbsp;&nbsp;&nbsp;&nbsp;
										<a id="supplier-add-href" style="text-decoration: underline; color: black; float:left">[[#{supplier.regist}]]</a>
									</div>
								</div>
							</div>
						</div>

						<div class="layui-col-xs12 layui-col-lg4 layui-col-lg-offset4 febs-hide" id="regist-div">
							<div class="layui-form" lay-filter="regist-form">
								<div class="layui-anim layui-anim-upbit">
									<ul class="login-type-tab">
										<li class="active">[[#{user.regist}]]</li>
									</ul>
									<div class="normal-login-form">
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-username"></label>
											<input type="text" name="username" minlength="2" maxlength="10" lay-verify="range" th:placeholder="#{user.name}"
											 autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-cellphone"></label>
											<input type="text" name="mobile" lay-verify="phone" th:placeholder="#{user.mobile}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-mail"></label>
											<input type="text" name="email" lay-verify="email" maxlength="50" th:placeholder="#{user.email}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item" id="item_dept">
											<input type="text" name="deptId" id="user-add-dept" class="layui-input">
										</div>
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-home"></label>
											<input type="text" name="companyNameZh" maxlength="50" th:placeholder="#{user.companyNameZh}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-bank"></label>
											<input type="text" name="companyNameEn" maxlength="50" th:placeholder="#{user.companyNameEn}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item">
											<label class="layui-icon label-icon layui-icon-location"></label>
											<input type="text" name="companyAddress" th:placeholder="#{user.companyAddress}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item password-block">
											<label class="layui-icon label-icon layui-icon-password"></label>
											<input type="password" name="password" minlength="6" lay-verify="range" th:placeholder="#{user.password}" autocomplete="off"
											 class="layui-input">
										</div>
										<div class="layui-form-item password-block">
											<label class="layui-icon label-icon layui-icon-password"></label>
											<input type="password" name="passwordB" lay-verify="required" th:placeholder="#{user.passwordB}" autocomplete="off" class="layui-input">
										</div>
										<div class="layui-form-item">
											<button class="layui-btn layui-btn-normal layui-btn-fluid" lay-submit lay-filter="regist-submit" id="regist">
												<i style="display: none" class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i>
												[[#{user.signUp}]]
											</button>
										</div>
									</div>
								</div>
								<div class="layui-form-item febs-tr">
									<a id="login-href">[[#{user.sign}]]</a>
								</div>
							</div>
						</div>
						
						<div class="layui-col-xs12 layui-col-lg4 layui-col-lg-offset4 febs-hide" id="supplier-div">
							<div class="layui-form" lay-filter="supplier-form">
								<div class="layui-anim layui-anim-upbit">
									<ul class="login-type-tab">
										<li class="active">[[#{supplier.regist}]]</li>
									</ul>
									<div class="normal-login-form">
										<div class="layui-form-item">
										    <label class="layui-form-label febs-form-item-require">[[#{supplier.companyName}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="companyName" class="layui-input" lay-verify="required">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label">[[#{supplier.companyCode}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="companyCode" class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label">[[#{supplier.address}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="address"  class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label">[[#{supplier.userName}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="userName" class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label febs-form-item-require">[[#{supplier.telephone}]]</label>
										    <div class="layui-input-block">
												 <input type="tel" name="telephone" lay-verify="required|phone" autocomplete="off" class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label febs-form-item-require">[[#{supplier.email}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="email" lay-verify="required|email|username" maxlength="50" autocomplete="off"
										               class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item layui-form-text">
										    <label class="layui-form-label">[[#{supplier.businessDescription}]]</label>
										    <div class="layui-input-block">
										        <textarea name="businessDescription" maxlength="100" class="layui-textarea"></textarea>
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label">[[#{supplier.keyword}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="keyword" class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label">[[#{supplier.field1}]]</label>
										    <div class="layui-input-block">
										        <input type="text" name="field1" class="layui-input">
										    </div>
										</div>
										<div class="layui-form-item">
										    <label class="layui-form-label febs-form-item-require">[[#{supplier.number1}]]</label>
										    <div class="layui-input-block">
										        <input type="radio" name="number1" value="1" th:title="#{supplier.y}" checked="checked">
										        <input type="radio" name="number1" value="0" th:title="#{supplier.n}">
										    </div>
										</div>
										<div class="layui-form-item">
											<button class="layui-btn layui-btn-normal layui-btn-fluid" lay-submit lay-filter="supplier-submit" id="supplier">
												<i style="display: none" class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i>
												[[#{user.signUp}]]
											</button>
										</div>
									</div>
								</div>
								<div class="layui-form-item febs-tr">
									<a id="login-href1">[[#{user.sign}]]</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script th:src="@{layui/layui.js}"></script>
		<script th:inline="javascript">
			var ctx = [[@{/}]];
			layui.extend({
				validate: './febs/lay/modules/validate',
				treeSelect: './febs/lay/extends/treeSelect'
			}).use(['form', 'layer', 'validate', 'treeSelect'], function(form, layer) {
				var $ = layui.jquery,
					validate = layui.validate,
					$view = $('#febs-login'),
					type = 'login',
					treeSelect = layui.treeSelect,
					$loginDiv = $view.find('#login-div'),
					$registDiv = $view.find('#regist-div');
					$supplierDiv = $view.find('#supplier-div');

				form.verify(validate);
				form.render();
				initCode();
					
				$(document).ready(function(){
					if("EN"==[[${lang}]]){
						$view.find('#changeLangEN').hide();
						$view.find('#changeLangZH').show();
					}else{			
						$view.find('#changeLangEN').show();
						$view.find('#changeLangZH').hide();
					}
					
				});	
				//提交登录表单
				form.on('submit(login-submit)', function(data) {
					var loading = $(this).find('.layui-icon');
					if (loading.is(":visible")) return;
					loading.show();
					$.post(ctx + 'login', data.field, function(r) {
						if (r.code === 200) {
							location.href = ctx + 'index';
						} else {
							layer.msg(r.message);
							loading.hide();
							initCode();
						}
					});
					return false;
				});

				treeSelect.render({
					elem: $view.find('#user-add-dept'),
					type: 'get',
					data: ctx + 'dept/getTree',
					placeholder: [[#{user.deptId}]],
					search: false,
				});

				//提交注册表单
				form.on('submit(regist-submit)', function(data) {
					if (data.field.password !== data.field.passwordB) {
						layer.msg([[#{user.passwordValidate}]]);
						return;
					}
					if (!data.field.deptId) {
						layer.msg([[#{user.deptIdValidate}]]);
						return;
					}
					if (!data.field.companyNameEn && !data.field.companyNameZh) {
						layer.msg([[#{user.companyNameValidate}]]);
						return;
					}
					var loading = $(this).find('.layui-icon');
					if (loading.is(":visible")) return;
					loading.show();
					$.post(ctx + 'regist', data.field, function(r) {
						if (r.code === 200) {
							layer.msg([[#{user.registValidate}]]);
							loading.hide();
							$view.find('#login-href').trigger('click');
						} else {
							layer.msg(r.message);
							loading.hide();
						}
					});
					return false;
				});
				
				//提交注册供应商表单
				form.on('submit(supplier-submit)', function(data) {
					var loading = $(this).find('.layui-icon');
					if (loading.is(":visible")) return;
					loading.show();
					$.post(ctx + 'tSupplier', data.field, function(r) {
						if (r.code === 200) {
							layer.msg([[#{supplier.registValidate}]]);
							loading.hide();
							$view.find('#login-href1').trigger('click');
						} else {
							layer.msg(r.message);
							loading.hide();
						}
					});
					return false;
				});

				function initCode() {
					$view.find('#codeimg').attr("src", ctx + "images/captcha?data=" + new Date().getTime());
				}

				$view.find('#codeimg').on('click', function() {
					initCode();
				});

				$view.find('#regist-href').on('click', function() {
					resetForm();
					type = 'regist';
					$loginDiv.hide();
					$supplierDiv.hide();
					$registDiv.show();
				});

				$view.find('#login-href').on('click', function() {
					resetForm();
					type = 'login';
					$loginDiv.show();
					$registDiv.hide();
					$supplierDiv.hide();
				});
				
				$view.find('#login-href1').on('click', function() {
					resetForm();
					type = 'login';
					$loginDiv.show();
					$registDiv.hide();
					$supplierDiv.hide();
				});
				
				$view.find('#supplier-add-href').on('click', function() {
					resetForm();
					type = 'regist';
					$supplierDiv.show();
					$loginDiv.hide();
					$registDiv.hide();
				});

				$view.find('#changeLangEN').on('click', function() {
					window.location.href=ctx+'login?lang=EN';
				});
				
				$view.find('#changeLangZH').on('click', function() {
					window.location.href=ctx+'login?lang=ZH';
				});

				function resetForm() {
					$registDiv.find('input[name="username"]').val('')
						.end().find('input[name="password"]').val('')
						.end().find('input[name="passwordB"]').val('');

					$loginDiv.find('input[name="username"]').val('')
						.end().find('input[name="password"]').val('')
						.end().find('input[name="verifyCode"]').val('');
				}

				$(document).on('keydown', function(e) {
					if (e.keyCode === 13) {
						if (type === 'login')
							$view.find('#login').trigger("click");
						if (type === 'regist')
							$view.find('#regist').trigger("click");
					}
				});
			});
		</script>
	</body>
</html>
